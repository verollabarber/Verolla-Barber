<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Verolla Barber</title>

<!-- EMAILJS -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body { background:#000; color:#fff; font-family:Arial; display:flex; justify-content:center }
.app { max-width:420px; width:100%; padding:16px }
button { padding:10px; border:none; border-radius:10px; cursor:pointer }
button.disabled { background:#111; color:#444; cursor:not-allowed }
button.selected { background:#5ddcff; color:#000; font-weight:bold }
.days,.times { display:grid; gap:8px }
.days { grid-template-columns:repeat(7,1fr) }
.times { grid-template-columns:repeat(4,1fr); margin-top:10px }
input { padding:10px; border-radius:8px; border:none }
.confirm { background:#2ecc71; font-weight:bold; margin-top:12px }
</style>
</head>

<body>
<div class="app">
  <h2>Verolla Barber</h2>

  <div class="days" id="days"></div>
  <div class="times" id="times"></div>

  <input id="name" placeholder="Seu nome">
  <input id="phone" placeholder="Telefone">

  <button class="confirm" onclick="confirmBooking()">Confirmar</button>
</div>

<script>
/* EMAILJS */
emailjs.init("SKRt9QiVvnUQV7YxK");

/* FIREBASE */
firebase.initializeApp({
  apiKey: "SUA_API_KEY",
  authDomain: "SEU_DOMINIO.firebaseapp.com",
  projectId: "SEU_PROJECT_ID"
});
const db = firebase.firestore();

/* VARIÁVEIS */
let selectedDate = null;
let selectedTime = null;

/* CALENDÁRIO SIMPLES (7 dias) */
const daysEl = document.getElementById("days");
for (let i = 0; i < 7; i++) {
  const d = new Date();
  d.setDate(d.getDate() + i);
  const dateStr = d.toISOString().split("T")[0];

  const btn = document.createElement("button");
  btn.innerText = dateStr;
  btn.onclick = () => {
    document.querySelectorAll(".days button").forEach(b => b.classList.remove("selected"));
    btn.classList.add("selected");
    selectedDate = dateStr;
    loadTimes();
  };
  daysEl.appendChild(btn);
}

/* GERAR HORÁRIOS */
function generateTimes() {
  const list = [];
  let h = 10, m = 30;
  while (h < 22) {
    const ampm = h >= 12 ? "PM" : "AM";
    const hh = h % 12 || 12;
    list.push(`${hh}:${m.toString().padStart(2,"0")} ${ampm}`);
    m += 30;
    if (m === 60) { m = 0; h++; }
  }
  return list;
}

/* CARREGAR HORÁRIOS BLOQUEADOS */
async function loadTimes() {
  const timesEl = document.getElementById("times");
  timesEl.innerHTML = "";
  const times = generateTimes();

  for (const time of times) {
    const id = `${selectedDate}_${time.replace(" ","_")}`;
    const doc = await db.collection("agendamentos").doc(id).get();

    const btn = document.createElement("button");
    btn.innerText = time;

    if (doc.exists) {
      btn.classList.add("disabled");
    } else {
      btn.onclick = () => {
        document.querySelectorAll(".times button").forEach(b => b.classList.remove("selected"));
        btn.classList.add("selected");
        selectedTime = time;
      };
    }
    timesEl.appendChild(btn);
  }
}

/* CONFIRMAR */
async function confirmBooking() {
  const name = document.getElementById("name").value.trim();
  const phone = document.getElementById("phone").value.trim();

  if (!name || !phone || !selectedDate || !selectedTime) {
    alert("Preencha tudo");
    return;
  }

  const id = `${selectedDate}_${selectedTime.replace(" ","_")}`;

  await db.collection("agendamentos").doc(id).set({
    date: selectedDate,
    time: selectedTime,
    name,
    phone
  });

  emailjs.send("service_ucr7o0r","template_nr857m8",{
    name,
    phone,
    day: selectedDate,
    time: selectedTime
  });

  alert("Agendamento confirmado!");
  location.reload();
}
</script>
</body>
</html>
